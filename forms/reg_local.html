
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Form</title>
    <script
    src="https://code.jquery.com/jquery-3.6.0.js"
    integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="../css/reg.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
    <body>

        <div class="container .bg-primary">

            <!-- Add/Remove -->
            <div class="row">
                    <div class="col-md-2">
                    </div>
                    <!-- p-l-5 padding - left - size5 -->
                    <div class="col-md-8 border border-primary  ml-3 mb-3 mr-3">
                        <div id="topButtonsDiv">
                         
                            <button class="btn btn-success btn-lg btn-block" type="button" id="btnStart" 
                            onclick='$("#btnContinue").attr("disabled","true"); $("#regForm").removeAttr("hidden"); $("#continueRegDiv").attr("hidden");'>
                                Start Online Course Registration
                            </button>
                            <button class="btn btn-success btn-lg btn-block" type="button" id="btnContinue" 
                            onclick='$("#continueRegDiv").removeAttr("hidden");'>
                                Continue Registration from where you Stopped
                            </button>
                            <div class="form-row" id="continueRegDiv" hidden>

                                <div class="form-row">
                                    <div class="form-group col-md-3">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="name">MAT. NO.</label>
                                        <input type="text" id="searchMatno" name="searchMatno" placeholder="ENG..." required autofocus />
                                        <label for="psw"><b>Password</b></label>
                                        <input type="password" placeholder="Enter Password" name="psw" id="psw" required>       

                                        <label for="load_data_button">Click to load your personal data</label>
    
                                        <button class="btn btn-outline-success btn-block load_data_button" id="load_reg_data_button" type="button">Load Personal Data</button>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <p></p>

                                    </div>
                                </div>
                            </div>    

                        </div>

                        <form id="regForm" action="" method="post" class="ml-5 mb-3 mr-5 mt-5" hidden>
                            <h1>Course Registration</h1>
                             <h3>Fill the form below and press the submit button!</h3>
                            
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="name">MAT. NO.</label>
                                    <input type="text" id="matno" name="matno" placeholder="ENG..." required autofocus />
                                </div>
                                <div class="form-group col-md-6">
                                    <p></p>
                                    <label for="load_data_button">Click to load your personal data</label>

                                    <button class="btn btn-outline-success btn-block load_data_button" id="load_reg_data_button" type="button">Load Personal Data</button>
                                </div>
                            </div>

                            <!-- <div class="input-group mb-3"><input type="text" id="matno" name="matno" placeholder="ENG..." required="" /><div class="input-group-append"><button class="btn btn-outline-success load_data_button" id="load_data_button" type="button" onclick="PopulateDropDownList()">Load Personal Data</button></div></div> -->

                            <br>
                            <label for="student_surname"><b>SURNAME (in capital letters)</b></label>
                            <input type="text" placeholder="SURNAME" name="student_surname" id="student_surname" required>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="dob"><b>Firstname *</b></label>
                                    <input type="text" placeholder="Firstname *" name="student_firstname"  id="student_firstname"  required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="student_othernames"><b>Othernames</b></label>               
                                    <input type="text" placeholder="Othernames" name="student_othernames" id="student_othernames">                           
                                </div>

                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                  <label for="inputCity">Dept ID (eg 1 for CPE)</label>
                                  <input type="text" class="form-control" id="student_dept_idr" name="student_dept_idr" value = "1" hidden>
                                  <select id="dept_idr" name="dept_idr" class="form-control">
                                    <option selected>1. Computer Engineering</option>
                                    <option>2. Computing and Computer Technology</option>
                                  </select>
                                </div>
                                <div class="form-group col-md-3">
                                  <label for="inputState">Session</label>
                                  <select id="session_idr" name="session_idr" class="form-control">
                                    <option selected>2020/2021</option>
                                    <option>2021/2022</option>
                                    <option>2022/2023</option>
                                    <option>2023/2024</option>
                                  </select>
                                </div>
                                <div class="form-group col-md-3">
                                  <label for="level">Level</label>
                                  <select id="level" name="level" class="form-control">
                                    <option selected>100</option>
                                    <option>200</option>
                                    <option>300</option>
                                    <option>400</option>
                                    <option>500</option>
                                  </select>
                                </div>
                            </div>

                            <!-- <label for="student_dept_idr"><b>Department ID (e.g 1 for CPE, 2 for ...)</b></label>
                            <input type="text" placeholder="1" name="student_dept_idr" id="student_dept_idr" required>
                            <label for="email"><b>Department ID (e.g 1 for CPE, 2 for ...)</b></label>
                            <input type="text" placeholder="1" name="dept_idr" id="dept_idr" required>
                            <label for="status"><b>Status (e.g Successful, Probation)</b></label>
                            <input type="text" placeholder="Successful" name="status" id="status" required>
                            <label for="email"><b>Year of Entry (e.g 2019)</b></label>
                            <input type="text" placeholder="year_of_entry" name="year_of_entry" id="year_of_entry" required>
                            <label for="email"><b>Session of Entry (Session you gained admission eg 2019/2020)</b></label>
                            <input type="text" placeholder="session_idr_of_entry" name="session_idr_of_entry" id="session_idr_of_entry" required>
                            <label for="mode_of_entry"><b>Mode of Entry (UME or DE)</b></label>
                            <input type="text" placeholder="mode_of_entry" name="mode_of_entry" id="mode_of_entry" required>
                            <label for="session_idr"><b>Session (e.g 2020/2021)</b></label>
                            <input type="text" placeholder="session_idr" name="session_idr" id="session_idr" required> -->

                            <div class="form-row">
                                <div class="form-group col-md-4">
                                  <label for="year_of_entry">Year of Entry (e.g 2019)</label>
                                  <select id="dept_idr" name="dept_idr" class="form-control">
                                    <option selected>2019</option>
                                    <option>2020</option>
                                  </select>
                                </div>
                                <div class="form-group col-md-4">
                                  <label for="session_idr_of_entry">Session of Entry</label>
                                  <select id="session_idr_of_entry" name="session_idr_of_entry" class="form-control">
                                    <option selected>2020/2021</option>
                                    <option>2021/2022</option>
                                    <option>2022/2023</option>
                                    <option>2023/2024</option>
                                  </select>
                                </div>
                                <div class="form-group col-md-4">
                                  <label for="mode_of_entry">Mode of Entry (UME or DE)</label>
                                  <select id="mode_of_entry" name="mode_of_entry" class="form-control">
                                    <option selected>UME</option>
                                    <option>DE</option>
                                  </select>
                                </div>
                            </div>

                            <!-- <label for="Fees_Status"><b>Fees_Status</b></label> -->
                            <!-- <input type="text" placeholder="Fees_Status" name="Fees_Status" id="Fees_Status" required> -->
                            <!-- <label for="level"><b>level</b></label> -->
                            <!-- <input type="text" placeholder="level" name="level" id="level" required> -->
                            <div class="form-row">

                                <div class="form-group col-md-6">
                                    <label for="psw"><b>Password</b></label>
                                    <input type="password" placeholder="Enter Password" name="psw" id="psw" required>       
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="psw-repeat"><b>Repeat Password</b></label>
                                    <input type="password" placeholder="Repeat Password" name="psw-repeat" id="psw-repeat" required>
                                </div>

                            </div>                                    


                            <hr>
                            <!-- <label for="dob"><b>Date of birth *</b></label>
                            <input type="text" placeholder="Date of birth *" name="dob"  id="dob" onfocus="(this.type = 'date')" required >
                            <br>
                            <label for="phone"><b>Phone number *</b></label>                        
                            <input type="text" placeholder="Phone number *" name="phone" id="phone" required >
                            <label for="email"><b>Email *</b></label>               
                            <input type="email" placeholder="Your email *" name="email" required >                        
                             -->
                             <p>Bio Data</p>
                             <label for="dob"><b>Date of birth *</b></label>
                             <input type="text" placeholder="Date of birth *" name="dob"  id="dob" onfocus="(this.type = 'date')" required>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="email"><b>Email *</b></label>
                                    <input type="text" placeholder="Email *" name="email"  id="email"  required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="phone"><b>Phone</b></label>               
                                    <input type="text" placeholder="Phone" name="phone" id="phone">                           
                                </div>

                            </div>



                            <div class="form-row">
                                <div class="form-group col-md-6">
                                  <label for="gender">Gender</label>
                                  <!-- <input type="text" class="form-control" id="gender" name="student_dept_idr" value = "1" hidden> -->
                                  <select id="gender" name="gender" class="form-control">
                                    <option selected>male</option>
                                    <option>female</option>
                                  </select>
                                </div>
                                <div class="form-group col-md-3">
                                  <label for="Fees_Status">Fees</label>
                                  <select id="Fees_Status" name="Fees_Status" class="form-control">
                                    <option selected>paid</option>
                                    <option>unpaid</option>
                                  </select>
                                </div>
                                <div class="form-group col-md-3">
                                  <label for="status">Status</label>
                                  <select id="status" name="status" class="form-control">
                                    <option selected>Successful</option>
                                    <option>Probation</option>
                                    <option>Carry Over</option>
                                    <option>Transfer</option>
                                  </select>
                                </div>
                            </div>

                            <p>Upload Passport Photo (Max size 12kb)</p><input id="file_info"></input>
                            <input type="file" id="file" required>
                            <br><hr>
                            <h3>Add/Remove Courses</h3>
                            <div class="row">
                                <div class="col-md-12">
                                    <input class="btn btn-outline-info btn-lg btn-block" type="button" id="btnGenerate" value="Load Courses" onclick="PopulateDropDownList(91,0)" />
                                    <nav aria-label="...">
                                        <ul class="pagination">
                                          <!-- <li class="page-item disabled">
                                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                                          </li> -->
                                          <li class="page-item active"><a class="page-link" onclick="PopulateDropDownList(90,180)">1<span class="sr-only">(current)</span></a></li>
                                          <li class="page-item" onclick="PopulateDropDownList(90,90)" ><a class="page-link">2 </a></li>
                                          <li class="page-item" onclick="PopulateDropDownList(90,180)"><a class="page-link" >3</a></li>
                                          <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                          </li>
                                        </ul>
                                      </nav>
                                </div>
                               
                            </div>

                            



                            <div class="row p-l-5">
                                <div class="input_fields_wrap_1 col-md-6">
                                    <h5>First Semester Courses</h5>
                                    <input type="text" name="CourseCode_1" id="CourseCode_1" class="CourseCode_1" readonly />

                                    <div class="input-group mb-3"><select select class="w-75 p-1"  id="comboCourses_1"></select><div class="input-group-append"><button class="btn btn-outline-success add_field_button_1" type="button">Add</button></div></div>
                                </div>
                                <div class="input_fields_wrap_2 col-md-6">
                                    <h5>Second Semester Courses</h5>
                                    <input type="text"  class="CourseCode_2" id="CourseCode_2" name="CourseCode_2" value="" readonly />

                                    <div class="input-group mb-3"><select class="w-75 p-1"  id="comboCourses_2"></select><div class="input-group-append_2"><button class="btn btn-outline-success add_field_button_2" type="button">Add</button></div></div>
                                </div>
                                
                                <hr />
                                <br>
                                <p>TODO: NA Courses</p>
                            </div>

                            <p>Review before you click register</p>
                            <button type="submit" class="registerbtn">Register</button>
                        </form>
                    </div>
                    <div class="col-md-2">

                    </div>

            </div>
        </div>
        <hr>
        
        <!-- JavaScript add new form and respond to select(combo) changes-->
        <script>
            $(document).ready(function() {
                var max_fields      = 15; //maximum input boxes allowed
                var wrapper_1   		= $(".input_fields_wrap_1"); //Fields wrapper
                var wrapper_2   		= $(".input_fields_wrap_2"); //Fields wrapper
                var add_button_1      = $(".add_field_button_1"); //Add button ID
                var add_button_2      = $(".add_field_button_2"); //Add button ID
                // var update_button      = $(".update_field_button"); //Update button ID
                var x_1 = 1; //initlal text box count
                var x_2 = 1; //initlal text box count
                $(add_button_1).click(function(e){ //on add input button click
                    e.preventDefault();
                    if(x_1 < max_fields){ //max input box allowed
                        x_1++; //text box increment
                        var prevValue_1 = $("#CourseCode_1").val();
                        var dValue_1 = $("#comboCourses_1").val();
                        $(wrapper_1).append('<div class="input-group mb-3"><input placeholder="Enter Course Code" type="text" id="mytext_1[]" name="mytext_1[]" class="form-control" value="'+ dValue_1 + '"><div class="input-group-append"><button class="btn btn-danger mb-0 mt-1 ml-1 remove_field_1" type="button">Remove</button></div></div>'); //add input box
                        if (prevValue_1==""){
                            $("#CourseCode_1").val(  dValue_1 ); //change value   
                        }else{
                            $("#CourseCode_1").val( prevValue_1 + ";" + dValue_1 ); //change value                        
                        }
                    }
                });

                $(add_button_2).click(function(e){ //on add input button click
                e.preventDefault();
                    if(x_2 < max_fields){ //max input box allowed
                        x_2++; //text box increment
                        var prevValue_2 = $("#CourseCode_2").val();
                        var dValue_2 = $("#comboCourses_2").val();
                        $(wrapper_2).append('<div class="input-group mb-3"><input placeholder="Enter Course Code" type="text" id="mytext_2[]" name="mytext_2[]" class="form-control" value="'+ dValue_2 + '"><div class="input-group-append"><button class="btn btn-danger mb-0 mt-1 ml-1 remove_field_2" type="button">Remove</button></div></div>'); //add input box
                        if (prevValue_2==""){
                            $("#CourseCode_2").val(  dValue_2 ); //change value   
                        }else{
                            $("#CourseCode_2").val( prevValue_2 + ";" + dValue_2 ); //change value                        
                        }
                    }
                });


                $(wrapper_1).on("click",".remove_field_1", function(e){ //user click on remove text
                    e.preventDefault(); 
                    $(this).parent('div').parent('div').remove(); x_1--;
                    //removeCourse_1(x_1);
                    removeCourse(1);
                    });

                
                $(wrapper_2).on("click",".remove_field_2", function(e){ //user click on remove text
                    e.preventDefault(); 
                    $(this).parent('div').parent('div').remove(); x_2--;
                    //removeCourse_1(x_2);
                    removeCourse(2);
                    });
                
                $("#file").on("change", function (e) {
                    var count=1;
                    var files = e.currentTarget.files; // puts all files into an array
                    var approvedHTML="";
                    // call them as such; files[0].size will get you the file size of the 0th file
                    for (var x in files) {
                        var filesize = ((files[x].size/1024)/1024).toFixed(4); // MB
                        if (files[x].name != "item" && typeof files[x].name != "undefined" && filesize <= 10) { 
                            if (count > 1) {
                                approvedHTML += ", "+files[x].name;
                            }
                            else {
                                approvedHTML += files[x].name;
                            }
                            count++;
                        }
                    }
                    $("#file_info").val(approvedHTML);
                    console.log(approvedHTML);
                });
                
                //combo event
                $("#comboCourses").change(function(){
                    alert ("Course selected: " + $("#comboCourses").val() )

                });

            });

            function removeCourse(semester) {
                if(semester==1){
                    var rows = document.getElementsByName('mytext_1[]');
                    var Course_Code_Input =$("#CourseCode_1");
                } else{
                    var rows = document.getElementsByName('mytext_2[]');
                    var Course_Code_Input =$("#CourseCode_2");
                }
                    
                var selectedRows = [];
                // $(wrapper_2).append('<div class="input-group mb-3">
                //<input placeholder="Enter Course Code" type="text" id="mytext_2[]" 
                //name="mytext_2[]" class="form-control" value="'+ dValue_2 + '">
                //<div class="input-group-append"><button class="btn btn-danger mb-0 mt-1 ml-1 
                //remove_field_2" type="button">Remove</button></div></div>'); //add input box
                Course_Code_Input.val("" ); //clear it
                for (var i = 0, l = rows.length; i < l; i++) {

                    if (!rows[i].value=="") {
                        selectedRows.push(rows[i]);
                    }

                    var prevValue = Course_Code_Input.val( );
                    if (prevValue==""){
                        Course_Code_Input.val(  rows[i].value );
                    }else{
                        Course_Code_Input.val( prevValue + ";" + rows[i].value  ); //change value                        
                    }
                }
            }
            // function removeCourse_1() {
            //         var rows_1 = document.getElementsByName('mytext_1[]');
            //         var selectedRows = [];

            //         $("#CourseCode_1").val("" ); //clear it
            //         for (var i = 0, l = rows_1.length; i < l; i++) {
            //             if (!rows_1[i].value=="") {
            //                 selectedRows.push(rows_1[i]);
            //             }

            //             var prevValue_1 = $("#CourseCode_1").val( );
            //             if (prevValue_1==""){
            //                 $("#CourseCode_1").val(  rows_1[i].value );
            //             }else{
            //                 $("#CourseCode_1").val( prevValue_1 + ";" + rows_1[i].value  ); //change value                        
            //             }
            //         }
            // }
            
            // function removeCourse_2() {

            //         var rows = document.getElementsByName('mytext_2[]');
            //         var selectedRows = [];

            //         $("#CourseCode_2").val("" ); //clear it
            //         for (var i = 0, l = rows.length; i < l; i++) {
            //             if (!rows[i].value=="") {
            //                 selectedRows.push(rows[i]);
            //             }

            //             var prevValue_2 = $("#CourseCode_2").val( );
            //             if (prevValue_2==""){
            //                 $("#CourseCode_2").val(  rows[i].value );
            //             }else{
            //                 $("#CourseCode_2").val( prevValue_2 + ";" + rows[i].value  ); //change value                        
            //             }
            //         }
            // }
                 
            function PopulateDropDownList(limits, offset) {
                //load combos
                $("#btnGenerate").attr("disabled", "true");
                var courses_1 = [
                    { course_code: "CPE211", course_title: "CPE211-Title"},
                    { course_code: "CPE311", course_title: "CPE311"},
                    { course_code: "CPE321", course_title: "CPE321" },
                    { course_code: "CPE481", course_title: "CPE481"}
                ];
                var courses_2 = [
                    { course_code: "CPE212", course_title: "CPE212-Title"},
                    { course_code: "CPE313", course_title: "CPE313" },
                    { course_code: "CPE82", course_title: "CPE82"},
                    { course_code: "CPE572", course_title: "CPE572"}
                ];
                    // using the ajax() method directly to get data for comco
                    $.ajax({
                        type: "POST",
                        url: "http://localhost/rtps/web/back-end/public/index.php/api/get_table/courses/"+limits+"/"+ offset,
                        data: {},
                        dataType: "json",
                        encode: true,
                        }).done(function (data) {
                            courses_1=data;
                            courses_2=data;
                            fillcomboWithReturnedData(data);
                            console.log(data);
                            $("#btnGenerate").removeAttr("disabled");
                        });

                //Build an array containing course records.
                fillcomboWithReturnedData(courses_1);
                
    //             //first clear all courses
    //             $("#CourseCode_1").val(  "");
    //             $("#CourseCode_2").val(  "");

    //             //<select id="comboCourses_1"></select>
    //             $("#comboCourses_1").empty();
    //             $("#comboCourses_2").empty();

    //             var comboCourses_1 = $("#comboCourses_1");
    //             var comboCourses_2 = $("#comboCourses_2");
    //             $(courses_1).each(function () {
    //                 var option = $("<option />");
    //  
    //                 //Set course_title in Text part.
    //                 option.html(this.course_title);
    //  
    //                 //Set  course_code in Value part.
    //                 option.val(this.course_code);
    //  
    //                 //Add the Option element to DropDownList.
    //                 comboCourses_1.append(option);
    //             });
    //             $(courses_2).each(function () {
    //                 var option = $("<option />");
    //  
    //                 //Set course_title in Text part.
    //                 option.html(this.course_title);
    //  
    //                 //Set  course_code in Value part.
    //                 option.val(this.course_code);
    //  
    //                 //Add the Option element to DropDownList.
    //                 comboCourses_2.append(option);
    //             });
            }

            function fillcomboWithReturnedData(courses_1){
                //first clear all courses
                $("#CourseCode_1").val(  "");
                $("#CourseCode_2").val(  "");

                //<select id="comboCourses_1"></select>
                $("#comboCourses_1").empty();
                $("#comboCourses_2").empty();
     
                var comboCourses_1 = $("#comboCourses_1");
                var comboCourses_2 = $("#comboCourses_2");
                $(courses_1).each(function () {
                    
                    var option = $("<option />");
                    //Set course_title in Text part.
                    option.html(this.course_code + "-" + this.course_title);
     
                    //Set  course_code in Value part.
                    option.val(this.course_code);
     
                    //Add the Option element to DropDownList.
                    if(this.course_semester=="1") comboCourses_1.append(option);
                    if(this.course_semester=="2") comboCourses_2.append(option);
                    //comboCourses_1.append(option);
                    //comboCourses_2.append(option);
                });
            }
            function editReg(){
                location.reload();
            }
            function finalSubmit(){
                $(btnEdit).hide();
                $(btnFinalSubmit).hide();
                $(previewButtons).hide(); //hide the whole thing
                
            }
        </script>
        <!-- AJAX -->
        <script>     


            //ajax for posting form data
            $(document).ready(function () {
                // //using deffered
                // function getData() {
                //     var formData = {
                //         matno: $("#matno").val(),
                //         student_firstname: $("#student_firstname").val(),
                //         student_surname: $("#student_surname").val(),
                //         student_othernames: $("#student_othernames").val(),
                //         student_dept_idr: $("#student_dept_idr").val(),
                //         status: $("#status").val(),
                //         year_of_entry: $("#year_of_entry").val(),
                //         student_firstname: $("#student_firstname").val(),
                //         mode_of_entry: $("#mode_of_entry").val(),
                //         dob: $("#dob").val(),
                //         phone: $("#phone").val(),
                //         email: $("#email").val(),
                //         gender: $("#gender").val(),
                //         session_idr: $("#session_idr").val(),
                //         CourseCode_1: $("#CourseCode_1").val(),
                //         CourseCode_2: $("#CourseCode_2").val(),
                //         NA_CourseCode: $("#NA_CourseCode").val(),
                //         Fees_Status: $("#Fees_Status").val(),
                //         level: $("#level").val(),
                //         dept_idr: $("#dept_idr").val()
                //         };
                //     var form = $( this );
                //     //data: form.serialize(),
                //     $.ajax({
                //         type: "POST",
                //         url: "http://localhost/rtps/web/back-end/public/index.php/api/store_reg",
                //         data: formData,
                //         dataType: "json",
                //         encode: true,
                //         });
                // }

                // function handleData(data /* , textStatus, jqXHR */ ) {
                //     alert(data);
                //     //do some stuff
                //        let text = '<table class="table" border="1">';
                //                 for (let x in data) {
                //                     let formatedCourses1 = data[x].CourseCode_1 .replace(/;/g, "; ");
                //                     let formatedCourses2 = data[x].CourseCode_2 .replace(/;/g, "; ");
                //                     text += "<tr><td>MAT. NO.</td><td>" + data[x].matno + "</td></tr>";
                //                     text += "<tr><td>SURNAME</td><td>" + data[x].student_surname + "</td></tr>";
                //                     text += "<tr><td>First Name</td><td>" + data[x].student_firstname + "</td></tr>";
                //                     text += "<tr><td>Dept ID</td><td>Dept ID: " + data[x].student_dept_idr + "</td></tr>";
                                    
                //                     text += "<tr>";
                //                     text += "<td>Fist Semester Courses</td>";
                //                     text += "<td>Second Semester Courses</td>";
                //                     text += "</tr>";

                //                     text += "<tr>";
                //                     text += "<td><p class='text-wrap'>" + formatedCourses1+ "</p></td>";
                //                     text += "<td><p class='text-wrap'>" + formatedCourses2+ "</p></td>";
                //                     text += "</tr>";
                //                 }
                //                 text += "</table>"
                //                 $("#regForm").html("<div id='message'></div>");
                //                     $("#message")
                //                     .html("<h2>Reg Form Submitted!</h2>")
                //                     .append("<p>Print this slip and submit it to Course Adviser.</p>")
                //                     .append("<p>Student Registration Record (Awaiting Approval)</p>")
                //                     .append(text)
                //                     .hide()
                //                     .fadeIn(1500, function () {
                //                         $("#message").append(
                //                         "<a  href='https://edla4eva.github.io/forms/reg.html'>Back to Registration </a>" );
                //                 });
                //                 console.log(data);
                //                 //alert("Success. data: " + data);
                // }


                $("#regForm").submit(function (event) {

                    //getData().done(handleData);
                    //data: form.serialize(),
                    // data: formData,


                    var form = $( this );
                    var MatNo = $("#matno").val();

                    $.ajax({
                        type: "POST",
                        url: "http://localhost/rtps/web/back-end/public/index.php/api/store_reg",
                        data: form.serialize(),
                        dataType: "json",
                        encode: true,
                        success: function (data) {

                            //fetch data to verify if post was successful
                            $.ajax({
                                type: "GET",
                                url: "http://localhost/rtps/web/back-end/public/index.php/api/get_reg/"+ MatNo,
                                data: form.serialize(),
                                dataType: "json",
                                encode: true,
                                success: function (data) 
                                        {
                                            alert("Successful"); 
                                            console.log("get succeeded \n");
                                            console.log(data);



                                            let text = '';
                                            text += '<h2 class="text-center">UNIVERSITY OF BENIN, BENIN CITY</h2>';
                                            text += '<h4 class="text-center">FACULTY OF ENGINEERING</h4>';
                                            text += '<h5 class="text-center">EXAMINATION COURSE REGISTRATION FORM 2021/2022 SESSION</h5>';
                                            text += '<br>';
                                            text += '<table class="table" border="1">';
                                            // let formatedCourses1 = "";
                                            // let formatedCourses2 = "";
                                            let matno = "ENG999000";
                                            let surname= "OLA";
                                            let course='CPE000';
                                            let course2='CPE000';
                                            let credit ='3';

                                            if(data.lenght>0){alert("data returned");}
                                            console.log("coursecode \n" + data[0].CourseCode_1);
                                            let formatedCourses1 = data[0].CourseCode_1 .replace(/;/g, "; ");
                                            let formatedCourses2 = data[0].CourseCode_2 .replace(/;/g, "; ");

                                            text += '<tr><td class="mw-40" style="width: 180px;">MATNO/ REG. NO</td><td>' + data[0].matno  + '</td><td rowspan="3" class="mw-40" style="width: 100px;"> <img width="150" height="150" src="rtps.keminsoft.site/public/index.php/api/jpg/img.png" /></td></tr>';
                                            text += '<tr><td>SURNAME</td><td>' + data[0].student_surname  + '</td></tr>';
                                            text += '<tr><td>OTHER NAMES</td><td>' + data[0].student_firstname  + '</td></tr>';
                                            text += '<tr><td>DEPARTMENT</td><td colspan="2">' + data[0].student_dept_idr  + '</td></tr>';
                                            text += '<tr><td>MODE OF ENTRY</td><td colspan="2">' + data[0].phone  + '</td></tr>';
                                            text += '<tr><td>LEVEL</td><td colspan="2">' + data[0].level  + '</td></tr>';
                                            text += '<tr><td>PHONE NO.</td><td colspan="2">' + data[0].student_surname  + '</td></tr>';
                                            text += '<tr><td>GENDER</td><td colspan="2">' + data[0].student_surname  + '</td></tr>';
                                            // text += "<tr>";
                                            // text += "<td class='text-wrap'><p class='text-wrap'>" + formatedCourses1+ "</p></td>";
                                            // text += "<td class='text-wrap' colspan='2'> <p class='text-wrap'>" + formatedCourses2 + "</p></td>";
                                            // text += "</tr>";
                                            text += '</table>';

                                            text += '<h5 class="text-center">REGISTER CARRY OVER COURSES FIRST</h5>';
                                            text += '<table class="table" border="1">';
                                            text += '<table class="table" border="1">';
                                            text += '<tr><td colspan=2>FIRST SEMESTER</td><td colspan=2>SECOND SEMESTER</td></tr>'; 
                                            text += '<tr><td>COURSE CODE</td><td class="mw-30" style="width: 100px;">CREDIT</td><td>COURSE CODE</td><td class="mw-30" style="width: 100px;">CREDIT</td></tr>';
                                            //for (let x in data) {
                                                course=formatedCourses1;
                                                course2=formatedCourses2;
                                                text += '<tr><td>' + course + '</td><td>'+ credit + '</td><td>' + course + '</td><td class="mw-40" style="width: 180px;">' + credit + '</td></tr>';
                                            //}
                                            text += '</table>';

                                            //signatures
                                            text += '<br>';
                                            text += '<table class="table table-borderless" >';
                                            text += '<tr><td colspan=2 class="text-center">________________________</td><td colspan=2></td><td colspan=2 class="text-center">________________________</td></tr>';
                                            text += '<tr><td colspan=2 class="text-center">Student\'s signature</td><td colspan=2 class="text-center">________________________</td><td colspan=2 class="text-center">Course Adviser\'s signature</td></tr>';
                                            text += '<tr><td colspan=2></td><td colspan=2 class="text-center">Dean\'s Signature</td><td colspan=2></td></tr>';                     
                                            text += '</table>';

                                            //buttons
                                            text += ("<p>Print this slip and submit it to your Course Adviser.</p>");
                                            text += ('<p class = "text text-info" hidden>Form Saved successfully! You can continue filling the form and submit later</p>');
                                            text += ('<p class = "text text-info" id ="infoSubmited" hidden>Form Submitted successfully!</p>');
                                            text += '<div id="previewButtons">';
                                                //todo if (data.submitted) editbutton.hidden = true
                                            text += ('<button class="btn btn-primary btn-lg btn-block"  type="button" id="btnEdit" onclick="editReg()"> Edit Form </button>');
                                            text += ('<button class="btn btn-primary btn-lg btn-block"  type="button" onclick="doPrint();" disabled> Print Form</button> <br>');
                                            text += ('<button class="btn btn-success btn-lg btn-block" id="btnFinalSubmit" type="button" onclick="finalSubmit()">Submit to Course Adviser (Cannot be Undone)</button>');
                                            text += '</div>';
                                            $("#regForm").html("<div id='message'></div>");
                                            $("#message")
                                                .html('<h2 class="text-center">Online Departmental Course Registration</h2>')
                                                .append("<p></p>")

                                                .append(text)
                                                .hide()
                                                .fadeIn(1500, function () {
                                                    $("#message").append(
                                                    "<p><a  href='https://edla4eva.github.io/forms/reg.html'>Back to Registration </a></p>" );
                                                });
                                        },
                                        error: function (data) {
                                            console.log(data);
                                            alert("An error occured fetching data \n" + data.responseJSON.message);
                                        }
                            });
                            //console.log(data); //no need to do this again

                        },
                        error: function (data) {
                            console.log(data);
                            alert("An error occured posting data\n" + data.responseJSON.message);

                        }
                    });

                    event.preventDefault();
                });

                
                $(load_reg_data_button).click(function(e){ //on add input button click
                    e.preventDefault();
                    // grab the ID and send AJAX request if not (empty / only whitespace)
                    var MatNo = $("#matno").val();
                    if (/\S/.test(MatNo)) {

                    // using the ajax() method directly
                    $.ajax({
                        type : "GET",
                        url : "http://localhost/rtps/web/back-end/public/index.php/api/get_reg/" + MatNo,
                        cache : false,
                        dataType : "json",
                        data : "{matno: 1}",
                        success : load_returnd_records_into_fields,
                        error: function(xhr) { alert("AJAX request failed: " + xhr.status); }
                    });

                    }
                    else {
                        alert("No MATNO supplied");
                    }

                });


            });
            
            

            /**
            * process the response, populating the form fields from the JSON data
            * @param {Object} response the JSON data parsed into an object
            */
            function load_returnd_records_into_fields(data) {
                var frm = $("#regForm");
                var i;

                // data= [
                //         {   "matno": "ENG390ajax",
                //             "student_firstname": "Ed",
                //             "student_surname": "OLAP",
                //             "student_othernames": "Prod",
                //             "student_dept_idr": "1",
                //             "status": "Successful",
                //             "year_of_entry": "0",
                //             "session_idr_of_entry": "Ed",
                //             "mode_of_entry": "UME",
                //             "dob": "2022-12-13",
                //             "phone": "333",
                //             "email": "eddie.olaye@gmail.com",
                //             "gender": "male",
                //             "session_idr": "2020/2021",
                //             "CourseCode_1": "CPE311",
                //             "CourseCode_2": "CPE311",
                //             "NA_CourseCode": "0",
                //             "Fees_Status": "paid",
                //             "level": "200",
                //             "dept_idr": "1"
                //         }
                //     ];

                console.dir(data);      // for debug

                for (i in data) {
                    console.log(i); 
                    frm.find('[name="' + i + '"]').val(data[i]);
                    for (field in data[i]) {
                        console.log(data[i][field]); 
                        frm.find('[name="' + field + '"]').val(data[i][field]);
                    }
                }
            }


        </script>
        <!-- Extra JavaScript Send form data as json-->
        <script>
            // function convertFormToJSON(form) {
            //     const array = $(form).serializeArray(); // Encodes the set of form elements as an array of names and values.
            //     const json = {};
            //     $.each(array, function () {
            //     json[this.name] = this.value || "";
            //     });
            //     return json;
            // }

            // AJAX for posting json
            // $("#regForm").on("submit", function (e) {
            //     e.preventDefault();
            //     const form = $(e.target);
            //     const json = convertFormToJSON(form);
            //     console.log(json);
            //     //send to backend
            //     var data = {
            //     test: $( "#test" ).val()
            //     };
            //     var options = {
            //     url: "http://localhost/rtps/web/back-end/public/index.php/api/store_reg",
            //     dataType: "text",
            //     type: "POST",
            //     data: { test: JSON.stringify( data ) }, // Our valid JSON string
            //     success: function( data, status, xhr ) {
            //         //...
            //     },
            //     error: function( xhr, status, error ) {
            //         //...
            //     }
            //     };
            //     $.ajax( options );

            //     //end send
            // });
            
            //Object { matno: "ENG12088909", student_firstname: "dfh", student_othernames: "h", student_surname: "fgh", student_dept_idr: "1", dept_idr: "1", status: "Succ", year_of_entry: "44", session_idr_of_entry: "323", mode_of_entry: "ume", … }


            //AJAX for posting json
            //   $(document).ready( function() {
            //     $.ajax({
            //         type: 'POST',
            //         url:  'http://localhost/rtps/web/back-end/public/index.php/api/store_reg',  //evaluates to ->svr/model.php?parent_idr<6'
            //         data: {'parent_idr' : '0'},
            //         dataType: 'json',
            //         cache: false,
            //         success: function(result) {
                    
            //             console.log('Hey!' + JSON.stringify(result));
            //             var dR;
            //             dR= JSON.stringify(result);
            //             dR.replace(/\s+/g,'');
            //             alert("success");
            //             // var Html = "<div id='myDivWM'>Copyright Obadan Family</div>";
            //             // $("body").append(Html);
                        
            //         },
            //     });
            //   });
        </script>



    </body>
</html>
